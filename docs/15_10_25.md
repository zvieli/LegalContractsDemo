
להלן ריכוז פערים עיקריים בין החוזים החדשים (NDATemplate, EnhancedRentContract, ContractFactory) לבין שאר הריפו (פרונט, בקאנד, דוקומנטציה, טסטים):

---

### פערים עיקריים – חוזים חדשים מול הריפו

#### 1. **פרונטנד**
- **ABIs:** יש לוודא שה-ABIs של EnhancedRentContract ו-NDATemplate מועתקים ל-`front/src/utils/contracts/` (סקריפט copy-abi).
- **ContractService:** 
  - יש פונקציות שמניחות שימוש ב-TemplateRentContract בלבד (`createContractInstanceAsync('TemplateRentContract', ...)`). צריך להוסיף תמיכה ב-EnhancedRentContract.
  - פונקציות כמו `reportRentDispute`, `getRentContractDetails` – לבדוק שהן מזהות נכון את סוג החוזה (NDA/Rent/EnhancedRent).
  - פונקציות NDA – לוודא שהן תואמות את NDATemplate החדש (שדות, אירועים, לוגיקת הפקטורי).
- **UI:** 
  - מסכים/מודלים שמציגים פרטי חוזה, אירועים, dispute – לעדכן שיזהו גם EnhancedRentContract ו-NDATemplate.
  - תפריטי יצירת חוזה – להציע רק NDA/EnhancedRent, לא TemplateRentContract רגיל.

#### 2. **בקאנד**
- **אינטגרציה עם ABIs:** לוודא שהבקאנד משתמש ב-ABIs העדכניים של EnhancedRentContract ו-NDATemplate.
- **סקריפטים/מודולים:** 
  - כל סקריפט שמאתחל חוזה, בודק סוג חוזה, או קורא אירועים – לעדכן שיתמוך ב-EnhancedRentContract ו-NDATemplate בלבד.
  - מודול evidence – לוודא שהוא תומך במרקל evidence (batching) של EnhancedRentContract.
- **טסטים:** 
  - טסטים שמייצרים חוזים דרך הפקטורי – לעדכן שיתמכו רק ב-NDA/EnhancedRent.
  - טסטים שמבצעים dispute/arbitration – לבדוק שהם תואמים את האירועים והפונקציות החדשות.

#### 3. **דוקומנטציה**
- **README/Guides:** לעדכן דוקומנטציה כך שתשקף את השימוש רק ב-NDATemplate ו-EnhancedRentContract.
- **ספסיפיקציה:** לוודא שכל הפיצ'רים החדשים (מרקל evidence, אירועים, לוגיקת פקטורי) מתועדים.

#### 4. **סקריפטים**
- **deploy.js / copy-abi.js:** לוודא שמפרסים רק NDA/EnhancedRent, ושה-ABIs שלהם מועתקים לפרונט/בקאנד.
- **סקריפטים ישנים:** למחוק/להסיר תמיכה ב-TemplateRentContract רגיל.

#### 5. **טסטים**
- **E2E/Unit:** לעדכן טסטים כך שיבדקו רק NDA/EnhancedRent, כולל dispute, evidence, arbitration, factory.
- **Mock data:** לוודא שמדמה חוזים מהסוגים החדשים בלבד.

---

### תכנית עבודה מומלצת

1. **עדכון ABIs וסקריפטים** ✅
   - ✔️ סקריפטי הפריסה והעתקת ה-ABI עודכנו – רק NDA/EnhancedRent מועתקים, TemplateRentContract הוסר.

2. **עדכון ContractService בפרונט** ✅
   - להוסיף זיהוי חוזה לפי כתובת (אם EnhancedRentContract או NDATemplate).
   - לעדכן פונקציות dispute/evidence/withdraw/resolve שיתמכו במבנה החדש.

3. **עדכון UI** ✅
   - כל המסכים, מודלים, וטפסים שמציגים או יוצרים חוזה עודכנו לתמיכה ב-NDATemplate ו-EnhancedRentContract בלבד.
   - לוגיקת העלאת סעיפים מותאמים אישית (custom clauses) ל-IPFS/Helia נוספה לטפסי יצירת NDA, נשמר רק ה-hash בחוזה.
   - אפשרות ליצירת/הצגת TemplateRentContract הוסרה לחלוטין.
   - תפריטי יצירת חוזה מציעים רק NDA ו-EnhancedRent.
   - תצוגות פרטי חוזה מציגות שדות, אירועים, ומצבים ייחודיים ל-NDATemplate ו-EnhancedRentContract, כולל dispute, evidence, arbitration, מרקל evidence, ResolutionApplied וכו'.
   - מודלים/קומפוננטות שמטפלות ב-dispute/evidence מזהות נכון את סוג החוזה ומטפלות ב-evidence batch, dispute, arbitration לפי המבנה החדש.
   - תצוגות היסטוריית מחלוקות (dispute history) מציגות רק מחלוקות של NDA/EnhancedRent, החלטות LLM, תוצאות arbitration.
   - לוגיקת זיהוי חוזה לפי כתובת עודכנה: מזהה אם החוזה הוא NDA או EnhancedRent ומתאימה את התצוגה/טיפול בהתאם.
   - כל הקומפוננטות שמאזינות לאירועים מאזינות רק לאירועים הרלוונטיים (DisputeAppliedCapped, ResolutionApplied וכו').
   - טפסים/מודלים של הגשת evidence עודכנו לתמוך במבנה החדש (הצפנה, hash, IPFS וכו').
   - אין אזכורים/תמיכה ב-TemplateRentContract בשום מקום ב-UI.

4. **עדכון בקאנד** ✅
   - כל המודולים והסקריפטים עובדים עם ABIs החדשים של NDATemplate ו-EnhancedRentContract בלבד.
   - תמיכה מלאה בשליפת ושמירת סעיפים מותאמים אישית (custom clauses) לפי hash ב-IPFS/Helia.
   - כל ה-endpoints, לוגיקת evidence/arbitration, dispute history ועוד – תואמים את המבנה החדש בלבד.
   - אין תמיכה או קוד ל-TemplateRentContract.

5. **עדכון טסטים** 
   להלן תכנון מפורט לכל קובץ טסטים קיים וחדש, כולל מה לבדוק/לעדכן/להוסיף:

---

### קבצים קיימים:

1. **NDATemplate.e2e.test.js**
   - לבדוק: יצירה, חתימה, הפקדה, הגשת ראיות, פתיחת dispute, בוררות, customClauses, יישום החלטה.
   - להוסיף: תרחישי כשל, בדיקות אירועים, בדיקת אינטגרציה עם ArbitrationService.

2. **RentContract.test.js**
   - לעדכן: להמיר ל־EnhancedRentContract בלבד.
   - לבדוק: יצירה, חתימה, הפקדה, הגשת ראיות, dispute, arbitration, customClauses, יישום החלטה.
   - להוסיף: תרחישי כשל, בדיקות edge case.

3. **EvidenceUtilities.test.js**
   - לבדוק: קנוניקליזציה, דיגסטים, יציבות סדר.
   - להוסיף: תרחישי קלט לא תקין, סוגי ראיות שונים.

4. **MerkleEvidence.test.js**
   - לבדוק: רישום ראיות, batch, מניעת כפילויות, אימות proofs.
   - להוסיף: אינטגרציה עם חוזים החדשים, תרחישי כשל.

5. **normalization.test.js**
   - לבדוק: נורמליזציה של כתובות ומפתחות.
   - להוסיף: קלטים לא תקינים, תרחישי קצה.

6. **RecipientKeyRegistry.test.js**
   - לבדוק: רישום/מחיקת/החלפת מפתח, תוקף, אירועים.
   - להוסיף: תרחישי כשל, הרשאות.

7. **decryptFallbacks.test.js**
   - לבדוק: פענוח payloadים שונים, תרחישי מפתח.
   - להוסיף: payload אמיתי מהחוזים החדשים, תרחישי כשל.

8. **security.hardening.test.js**
   - לעדכן: לוודא בדיקות מול EnhancedRentContract בלבד.
   - לבדוק: מניעת legacy methods, הרשאות, edge cases.
   - להוסיף: תרחישי כשל, בדיקות אבטחה חדשות.

9. **EndToEndIntegration.test.js**
   - לבדוק: זרימה מלאה — העלאת ראיות, רישום batch, dispute, arbitration, LLM, Chainlink.
   - להוסיף: תרחישי כשל, בדיקות אירועים.

10. **V7BackendCCIPFullFlow.test.js**
    - לבדוק: זרימה מלאה של backend עם CCIP Oracle, dispute/arbitration.
    - להוסיף: תרחישי כשל ב־oracle/LLM, edge cases.

11. **V7BackendStandalone.test.js**
    - לבדוק: מודולי backend בנפרד, אינטגרציה עם API.
    - להוסיף: תרחישי כשל, בדיקות edge case.

---

### קבצים חדשים להוספה:

1. **EnhancedRentContract.e2e.test.js**
   - לבדוק: כל הזרימה של EnhancedRentContract (יצירה, חתימה, הפקדה, ראיות, dispute, arbitration, customClauses, יישום החלטה).

2. **ArbitrationService.e2e.test.js (גרסה חדשה)**
   - לבדוק: פתיחת dispute, הגשת ראיות, הפעלת LLM/Chainlink, יישום החלטה, בדיקת אירועים.

3. **EvidenceFlow.e2e.test.js**
   - לבדוק: העלאה ל־IPFS/Helia, קנוניקליזציה, רישום ב־Merkle, אימות digest, תרחישי כשל.

4. **CustomClauses.test.js**
   - לבדוק: העלאה, hash, אימות, אינטגרציה עם NDA/Rent.

5. **FrontendE2E.test.js**
   - לבדוק: יצירת חוזה, הגשת ראיות, פתיחת dispute, הצגת החלטת LLM, בדיקת event listeners.

6. **EdgeCases.test.js**
   - לבדוק: ראיה לא תקינה, dispute כפול, כשל ב־LLM, כשל ב־IPFS, הרשאות שגויות.

7. **AdminTools.test.js**
   - לבדוק: פענוח ראיות, ניהול מפתחות, הרשאות.

---


6. **עדכון דוקומנטציה** ✅
   - ✔️ README, guides, specs עודכנו – TemplateRentContract הוסר, נוספו דוגמאות ל-NDA/EnhancedRent.

---

אם תרצה, אפשר לפרט משימות קונקרטיות לכל תיקיה/מודול, או להתחיל לעדכן בפועל.